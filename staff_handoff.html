<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SERVE STATION</title>

  <!-- ベース（既存） -->
  <link rel="stylesheet" href="./ui_dark.css?v=2">

  <!-- 共通テーマ（既存） -->
  <link rel="stylesheet" href="./ui_theme.css?v=1">

  <!-- ★最小上書き：機能は触らず、あなたの理想の配置と視認性だけ確定 -->
  <style>
    /* ① 文字の太さを戻す（以前の“太い”感じ） */
    .name, .price, .navItem, .pill, .btn, .lineName, .lineQty, .lineSum {
      font-weight: 1000 !important;
    }

    /* ② スマホのヘッダーが見にくい問題：背景と余白を安定させる（以前に近い視認性） */
    header.appHeader{
      background: #51565f !important; /* ui_theme の --hdr-bg と同等 */
      border-bottom: 1px solid rgba(255,255,255,.18) !important;
    }
    .brandTitle{
      font-size: 28px !important;
      letter-spacing: 1.2px !important;
    }

    /* ③ 内訳：あなたの理想（左=商品名 / 右=×数量 + 小計）を全幅で固定 */
    .card .list .lineRow{
      display:flex !important;
      align-items:center !important;
      justify-content:space-between !important;
      flex-wrap:nowrap !important;
      gap:12px !important;
    }
    .card .list .lineName{
      flex: 1 1 auto !important;
      min-width: 0 !important;
      text-align:left !important;

      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;

      /* ★iPhone Safari で“文字だけ消える”事故を確実に殺す */
      color: #111 !important;
      -webkit-text-fill-color: #111 !important;
      background: none !important;
      opacity: 1 !important;
      visibility: visible !important;
    }
    .card .list .lineMeta{
      flex: 0 0 auto !important;
      display:flex !important;
      align-items:baseline !important;
      justify-content:flex-end !important;
      gap: 12px !important;
      white-space: nowrap !important;
      text-align:right !important;
    }
    .card .list .lineQty{
      color: rgba(15,23,42,.70) !important;
    }
    .card .list .lineSum{
      color: rgba(15,23,42,.86) !important;
      background: none !important;
      -webkit-text-fill-color: rgba(15,23,42,.86) !important;
    }

    /* ④ 体感速度：読み込み中メッセージが見えるように最低高さを確保（ラグに見えない） */
    #orderList{ min-height: 120px; }

    /* ⑤ スマホでコントロールが縦に崩れる事故を防ぐ（左詰め／必要なら横スクロール） */
    .toolRow{ flex-wrap:wrap; }
    .toolRight{
      width:100%;
      justify-content:flex-start !important;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
    }
    .toolRight select,
    .toolRight button,
    .toolLeft .pill{
      width:auto !important;
      flex: 0 0 auto;
    }
  </style>
</head>

<body>
<header class="appHeader">
  <div class="wrap headRow">
    <div class="brand">
      <div class="brandTitle">SERVE STATION</div>
    </div>

    <nav class="topNav">
      <a href="./staff_handoff.html" class="navItem active">受け渡し</a>
      <a href="./history.html" class="navItem">履歴</a>
      <a href="./sales.html" class="navItem">売上</a>
      <a href="./owner.html" class="navItem">設定</a>
    </nav>

    <div id="shopBar" class="shopBar">
      <span id="shopState" class="badge-open">
        <span class="dot-open"></span><span>受付：営業中</span>
      </span>
      <button id="btnToggleShop" class="btn btn-close">閉店（受付停止）</button>
    </div>
  </div>

  <div class="wrap toolRow">
    <div class="toolLeft">
      <span class="pill" id="countPill">0件</span>
    </div>

    <div class="ctrls toolRight">
      <select id="viewMode">
        <option value="3">通常（3件）</option>
        <option value="6">コンパクト（6件）</option>
      </select>

      <select id="sortMode">
        <option value="created">受付順</option>
        <option value="elapsed_desc">経過長い順</option>
        <option value="rank">手動順</option>
      </select>

      <select id="filterMode">
        <option value="">フィルタ：全て</option>
      </select>

      <button class="btn" id="btnRefresh">更新</button>

      <select id="autoInterval">
        <option value="10">自動 10秒</option>
        <option value="30" selected>自動 30秒</option>
        <option value="60">自動 60秒</option>
      </select>

      <button class="btn btnPrimary" id="btnAuto">自動更新：OFF</button>
    </div>
  </div>

  <div class="wrap">
    <div id="msgArea"></div>
  </div>
</header>

<main class="wrap">
  <div class="grid" id="orderList"></div>

  <div class="sectionTitle">その他の注文</div>
  <details id="othersBox">
    <summary id="othersSummary">その他の注文（0件）</summary>
    <div id="othersList"></div>
  </details>
</main>

<!-- 編集モーダル -->
<div class="overlay" id="overlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalHead">
      <div>
        <div class="modalTitle" id="mTitle">編集</div>
        <div class="mini" id="mSub"></div>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button class="btn" id="mClose">閉じる</button>
      </div>
    </div>

    <div id="mMsg"></div>

    <div class="divider"></div>

    <div><b>内訳（数量変更・0で削除）</b></div>
    <div id="mItems"></div>

    <div class="divider"></div>

    <div><b>品目追加</b></div>
    <div class="searchBox">
      <input type="search" id="mSearch" placeholder="商品名で検索" style="flex:1;">
    </div>
    <div class="prodList" id="mProds"></div>

    <div class="divider"></div>

    <div class="row">
      <div><b>合計</b></div>
      <div class="price" id="mTotal">¥0</div>
    </div>

    <div class="stickyFoot">
      <div class="actions">
        <button class="btn btnPrimary" id="mSave">保存</button>
        <button class="btn btnOk" id="mHanded">受け渡し完了</button>
        <button class="btn btnDanger" id="mCancel">キャンセル</button>
      </div>
      <div class="muted" style="margin-top:6px;">※完了/キャンセルは確認ダイアログあり</div>
    </div>
  </div>
</div>

<script>
  window.GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzeeGTJKZXHsVEw8DMz_QahMsnbqAUzDM3D_9mnv1LpVRxIitpL0F3xlCTwKUjV0OURzQ/exec";
</script>

<script src="./handoff.js"></script>
<script src="./ui.js?v=1"></script>
</body>
</html>
